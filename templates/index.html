<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Own vs Rent Analyzer</title>
  <!-- Link to external CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Own vs Rent? Make the smart decision!</h1>
  </header>

  <main>
    <div class="container">

      <!-- Existing input groups omitted for brevity -->

      <!-- Monthly travel (car) expense -->
      <div class="input-group">
        <label for="monthly_travel">Monthly Travel/Car Expenses ($/month):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="monthly_travel" 
            min="0" 
            max="2000" 
            step="50" 
            value="300" 
            oninput="syncValueFromSlider('monthly_travel')"
          >
          <input 
            type="text" 
            id="monthly_travel_text" 
            value="300" 
            oninput="syncValueFromText('monthly_travel')"
            onblur="validateInput('monthly_travel')"
          >
        </div>
      </div>

      <!-- Monthly groceries expense -->
      <div class="input-group">
        <label for="monthly_groceries">Monthly Groceries ($/month):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="monthly_groceries" 
            min="0" 
            max="2000" 
            step="50" 
            value="400" 
            oninput="syncValueFromSlider('monthly_groceries')"
          >
          <input 
            type="text" 
            id="monthly_groceries_text" 
            value="400" 
            oninput="syncValueFromText('monthly_groceries')"
            onblur="validateInput('monthly_groceries')"
          >
        </div>
      </div>

      <!-- Monthly bills expense -->
      <div class="input-group">
        <label for="monthly_bills">Monthly Bills (utilities, phone, etc.) ($/month):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="monthly_bills" 
            min="0" 
            max="2000" 
            step="50" 
            value="250" 
            oninput="syncValueFromSlider('monthly_bills')"
          >
          <input 
            type="text" 
            id="monthly_bills_text" 
            value="250" 
            oninput="syncValueFromText('monthly_bills')"
            onblur="validateInput('monthly_bills')"
          >
        </div>
      </div>

      <!-- Monthly healthcare expense -->
      <div class="input-group">
        <label for="monthly_healthcare">Monthly Healthcare Costs ($/month):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="monthly_healthcare" 
            min="0" 
            max="2000" 
            step="50" 
            value="200" 
            oninput="syncValueFromSlider('monthly_healthcare')"
          >
          <input 
            type="text" 
            id="monthly_healthcare_text" 
            value="200" 
            oninput="syncValueFromText('monthly_healthcare')"
            onblur="validateInput('monthly_healthcare')"
          >
        </div>
      </div>

      <!-- Existing button -->
      <button onclick="runSimulation()">Run Simulation</button>
    </div>

    <h2>Results</h2>
    <div id="results">
      <p id="renter_investment"></p>
      <p id="homeowner_investment"></p>
      <p id="final_house_value"></p>
      <p id="homeowner_net_worth"></p>
      <p id="renter_net_worth"></p>
      <p id="lifetime_income"></p>
      <p id="comparison"></p>
      <!-- New difference message -->
      <p id="difference_msg"></p>
    </div>
  </main>

  <footer>
    <p>
      Licensed under GPL 3.0 • Developed by <strong>Eli Gaultney</strong> • 
      <a href="https://github.com/elisspace/own_vs_buy/">GitHub Repo</a>
    </p>
  </footer>

  <script>
    // Sync from range input -> text input
    function syncValueFromSlider(id) {
      const rangeElement = document.getElementById(id);
      const textElement = document.getElementById(id + '_text');
      textElement.value = rangeElement.value;
    }

    // Sync from text input -> range input
    function syncValueFromText(id) {
      const rangeElement = document.getElementById(id);
      const textElement = document.getElementById(id + '_text');
      rangeElement.value = textElement.value;
    }

    // Basic validation to ensure numeric input and within min/max
    function validateInput(id) {
      const rangeElement = document.getElementById(id);
      const textElement = document.getElementById(id + '_text');

      let value = parseFloat(textElement.value);
      if (isNaN(value)) {
        alert("Invalid input. Please enter a valid numeric value.");
        textElement.value = rangeElement.value;
        return;
      }

      let min = parseFloat(rangeElement.min);
      let max = parseFloat(rangeElement.max);

      if (value < min) {
        alert("Value is below the minimum of " + min + ".");
        value = min;
      } else if (value > max) {
        alert("Value is above the maximum of " + max + ".");
        value = max;
      }

      textElement.value = value;
      rangeElement.value = value;
    }

    function runSimulation() {
      var params = {
        annual_income: parseFloat(document.getElementById('annual_income').value),
        home_price: parseFloat(document.getElementById('home_price').value),
        down_payment: parseFloat(document.getElementById('down_payment').value),
        mortgage_rate: parseFloat(document.getElementById('mortgage_rate').value) / 100,
        mortgage_term: parseFloat(document.getElementById('mortgage_term').value),
        property_tax_rate: parseFloat(document.getElementById('property_tax_rate').value) / 100,
        homeowner_insurance: parseFloat(document.getElementById('homeowner_insurance').value),
        maintenance_rate: parseFloat(document.getElementById('maintenance_rate').value) / 100,
        rent: parseFloat(document.getElementById('rent').value),
        rent_escalation_rate: parseFloat(document.getElementById('rent_escalation_rate').value) / 100,
        home_appreciation: parseFloat(document.getElementById('home_appreciation').value) / 100,
        investment_return: parseFloat(document.getElementById('investment_return').value) / 100,
        marginal_tax_rate: parseFloat(document.getElementById('marginal_tax_rate').value) / 100,
        inflation_rate: parseFloat(document.getElementById('inflation_rate').value) / 100,
        start_age: parseFloat(document.getElementById('start_age').value),
        end_age: parseFloat(document.getElementById('end_age').value),
        annual_salary_growth: 0.02,  // fixed for now
        renters_insurance_annual: 240,

        // New monthly expenses:
        monthly_travel: parseFloat(document.getElementById('monthly_travel').value),
        monthly_groceries: parseFloat(document.getElementById('monthly_groceries').value),
        monthly_bills: parseFloat(document.getElementById('monthly_bills').value),
        monthly_healthcare: parseFloat(document.getElementById('monthly_healthcare').value)
      };

      fetch('/calculate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(params)
      })
      .then(response => response.json())
      .then(data => {
        document.getElementById('renter_investment').innerText = "Renter's Final Investment Balance: $" + data.renter_final_investment.toFixed(2);
        document.getElementById('homeowner_investment').innerText = "Homeowner's Final Investment Balance: $" + data.homeowner_final_investment.toFixed(2);
        document.getElementById('final_house_value').innerText = "Final House Value: $" + data.final_house_value.toFixed(2);

        // Highlight negative net worth in red:
        const homeownerNetWorthEl = document.getElementById('homeowner_net_worth');
        const renterNetWorthEl = document.getElementById('renter_net_worth');

        homeownerNetWorthEl.innerText = "Homeowner Net Worth: $" + data.homeowner_net_worth.toFixed(2);
        renterNetWorthEl.innerText = "Renter Net Worth: $" + data.renter_net_worth.toFixed(2);

        if (data.homeowner_net_worth < 0) {
          homeownerNetWorthEl.style.color = "red";
        } else {
          homeownerNetWorthEl.style.color = "inherit";
        }

        if (data.renter_net_worth < 0) {
          renterNetWorthEl.style.color = "red";
        } else {
          renterNetWorthEl.style.color = "inherit";
        }

        document.getElementById('lifetime_income').innerText = "Lifetime Income: $" + data.lifetime_income.toFixed(2);

        let comparison = "";
        if (data.homeowner_net_worth > data.renter_net_worth) {
          comparison = "Home ownership is better over the set duration.";
        } else if (data.homeowner_net_worth < data.renter_net_worth) {
          comparison = "Renting is better over the set duration.";
        } else {
          comparison = "They are effectively the same over the set duration.";
        }
        document.getElementById('comparison').innerText = comparison;

        // Show difference in net amounts:
        let difference = data.homeowner_net_worth - data.renter_net_worth;
        const differenceMsgEl = document.getElementById('difference_msg');
        if (difference > 0) {
          differenceMsgEl.innerText = "By buying you'll come out $" + difference.toFixed(2) + " ahead.";
        } else if (difference < 0) {
          differenceMsgEl.innerText = "By renting you'll come out $" + Math.abs(difference).toFixed(2) + " ahead.";
        } else {
          differenceMsgEl.innerText = "Both scenarios end up exactly the same!";
        }
      })
      .catch(error => console.error("Error in fetch /calculate:", error));
    }
  </script>
</body>
</html>

