<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Own vs Rent Analyzer</title>
  <!-- Link to external CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Own vs Rent? Make the smart decision!</h1>
  </header>

  <main>
    <div class="container">

      <!-- ANNUAL INCOME -->
      <div class="input-group">
        <label for="annual_income">Annual Income ($):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="annual_income" 
            min="10000" 
            max="20000000" 
            step="10000" 
            value="60000" 
            oninput="syncValueFromSlider('annual_income')"
          >
          <input 
            type="text" 
            id="annual_income_text" 
            value="60000" 
            oninput="syncValueFromText('annual_income')"
            onblur="validateInput('annual_income')"
          >
        </div>
      </div>

      <!-- HOME PRICE -->
      <div class="input-group">
        <label for="home_price">Home Price ($):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="home_price" 
            min="100000" 
            max="150000000" 
            step="10000" 
            value="300000" 
            oninput="syncValueFromSlider('home_price')"
          >
          <input 
            type="text" 
            id="home_price_text" 
            value="300000" 
            oninput="syncValueFromText('home_price')"
            onblur="validateInput('home_price')"
          >
        </div>
      </div>

      <!-- DOWN PAYMENT -->
      <div class="input-group">
        <label for="down_payment">Down Payment ($):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="down_payment" 
            min="0" 
            max="500000" 
            step="5000" 
            value="60000" 
            oninput="syncValueFromSlider('down_payment')"
          >
          <input 
            type="text" 
            id="down_payment_text" 
            value="60000" 
            oninput="syncValueFromText('down_payment')"
            onblur="validateInput('down_payment')"
          >
        </div>
      </div>

      <!-- MORTGAGE RATE -->
      <div class="input-group">
        <label for="mortgage_rate">Mortgage Rate (%):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="mortgage_rate" 
            min="1" 
            max="10" 
            step="0.1" 
            value="4" 
            oninput="syncValueFromSlider('mortgage_rate')"
          >
          <input 
            type="text" 
            id="mortgage_rate_text" 
            value="4" 
            oninput="syncValueFromText('mortgage_rate')"
            onblur="validateInput('mortgage_rate')"
          >
        </div>
      </div>

      <!-- MORTGAGE TERM -->
      <div class="input-group">
        <label for="mortgage_term">Mortgage Term (years):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="mortgage_term" 
            min="10" 
            max="75" 
            step="5" 
            value="30" 
            oninput="syncValueFromSlider('mortgage_term')"
          >
          <input 
            type="text" 
            id="mortgage_term_text" 
            value="30" 
            oninput="syncValueFromText('mortgage_term')"
            onblur="validateInput('mortgage_term')"
          >
        </div>
      </div>

      <!-- PROPERTY TAX RATE -->
      <div class="input-group">
        <label for="property_tax_rate">Property Tax Rate (%):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="property_tax_rate" 
            min="0" 
            max="10" 
            step="0.1" 
            value="1.2" 
            oninput="syncValueFromSlider('property_tax_rate')"
          >
          <input 
            type="text" 
            id="property_tax_rate_text" 
            value="1.2" 
            oninput="syncValueFromText('property_tax_rate')"
            onblur="validateInput('property_tax_rate')"
          >
        </div>
      </div>

      <!-- HOMEOWNER INSURANCE -->
      <div class="input-group">
        <label for="homeowner_insurance">Homeowner Insurance ($/year):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="homeowner_insurance" 
            min="500" 
            max="20000" 
            step="1000" 
            value="1200" 
            oninput="syncValueFromSlider('homeowner_insurance')"
          >
          <input 
            type="text" 
            id="homeowner_insurance_text" 
            value="1200" 
            oninput="syncValueFromText('homeowner_insurance')"
            onblur="validateInput('homeowner_insurance')"
          >
        </div>
      </div>

      <!-- MAINTENANCE RATE -->
      <div class="input-group">
        <label for="maintenance_rate">Maintenance Rate (%):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="maintenance_rate" 
            min="0" 
            max="20" 
            step="1" 
            value="1" 
            oninput="syncValueFromSlider('maintenance_rate')"
          >
          <input 
            type="text" 
            id="maintenance_rate_text" 
            value="1" 
            oninput="syncValueFromText('maintenance_rate')"
            onblur="validateInput('maintenance_rate')"
          >
        </div>
      </div>

      <!-- RENT -->
      <div class="input-group">
        <label for="rent">Rent ($/month):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="rent" 
            min="100" 
            max="50000" 
            step="100" 
            value="1500" 
            oninput="syncValueFromSlider('rent')"
          >
          <input 
            type="text" 
            id="rent_text" 
            value="1500" 
            oninput="syncValueFromText('rent')"
            onblur="validateInput('rent')"
          >
        </div>
      </div>

      <!-- RENT ESCALATION RATE -->
      <div class="input-group">
        <label for="rent_escalation_rate">Rent Escalation Rate (%):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="rent_escalation_rate" 
            min="0" 
            max="10" 
            step="0.1" 
            value="3" 
            oninput="syncValueFromSlider('rent_escalation_rate')"
          >
          <input 
            type="text" 
            id="rent_escalation_rate_text" 
            value="3" 
            oninput="syncValueFromText('rent_escalation_rate')"
            onblur="validateInput('rent_escalation_rate')"
          >
        </div>
      </div>

      <!-- HOME APPRECIATION -->
      <div class="input-group">
        <label for="home_appreciation">Home Appreciation Rate (%):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="home_appreciation" 
            min="0" 
            max="10" 
            step="0.1" 
            value="3" 
            oninput="syncValueFromSlider('home_appreciation')"
          >
          <input 
            type="text" 
            id="home_appreciation_text" 
            value="3" 
            oninput="syncValueFromText('home_appreciation')"
            onblur="validateInput('home_appreciation')"
          >
        </div>
      </div>

      <!-- INVESTMENT RETURN -->
      <div class="input-group">
        <label for="investment_return">Investment Return (%):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="investment_return" 
            min="0" 
            max="25" 
            step="1" 
            value="5" 
            oninput="syncValueFromSlider('investment_return')"
          >
          <input 
            type="text" 
            id="investment_return_text" 
            value="5" 
            oninput="syncValueFromText('investment_return')"
            onblur="validateInput('investment_return')"
          >
        </div>
      </div>

      <!-- MARGINAL TAX RATE -->
      <div class="input-group">
        <label for="marginal_tax_rate">Marginal Tax Rate (%):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="marginal_tax_rate" 
            min="0" 
            max="100" 
            step="1" 
            value="25" 
            oninput="syncValueFromSlider('marginal_tax_rate')"
          >
          <input 
            type="text" 
            id="marginal_tax_rate_text" 
            value="25" 
            oninput="syncValueFromText('marginal_tax_rate')"
            onblur="validateInput('marginal_tax_rate')"
          >
        </div>
      </div>

      <!-- INFLATION RATE -->
      <div class="input-group">
        <label for="inflation_rate">Inflation Rate (%):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="inflation_rate" 
            min="0" 
            max="50" 
            step="1" 
            value="2" 
            oninput="syncValueFromSlider('inflation_rate')"
          >
          <input 
            type="text" 
            id="inflation_rate_text" 
            value="2" 
            oninput="syncValueFromText('inflation_rate')"
            onblur="validateInput('inflation_rate')"
          >
        </div>
      </div>

      <!-- START AGE -->
      <div class="input-group">
        <label for="start_age">Start Age:</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="start_age" 
            min="18" 
            max="75" 
            step="1" 
            value="30" 
            oninput="syncValueFromSlider('start_age')"
          >
          <input 
            type="text" 
            id="start_age_text" 
            value="30" 
            oninput="syncValueFromText('start_age')"
            onblur="validateInput('start_age')"
          >
        </div>
      </div>

      <!-- END AGE -->
      <div class="input-group">
        <label for="end_age">End Age:</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="end_age" 
            min="30" 
            max="120" 
            step="1" 
            value="65" 
            oninput="syncValueFromSlider('end_age')"
          >
          <input 
            type="text" 
            id="end_age_text" 
            value="65" 
            oninput="syncValueFromText('end_age')"
            onblur="validateInput('end_age')"
          >
        </div>
      </div>

      <!-- MONTHLY TRAVEL -->
      <div class="input-group">
        <label for="monthly_travel">Monthly Travel/Car Expenses ($/month):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="monthly_travel" 
            min="0" 
            max="10000" 
            step="100" 
            value="300" 
            oninput="syncValueFromSlider('monthly_travel')"
          >
          <input 
            type="text" 
            id="monthly_travel_text" 
            value="300" 
            oninput="syncValueFromText('monthly_travel')"
            onblur="validateInput('monthly_travel')"
          >
        </div>
      </div>

      <!-- MONTHLY GROCERIES -->
      <div class="input-group">
        <label for="monthly_groceries">Monthly Groceries ($/month):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="monthly_groceries" 
            min="0" 
            max="10000" 
            step="100" 
            value="400" 
            oninput="syncValueFromSlider('monthly_groceries')"
          >
          <input 
            type="text" 
            id="monthly_groceries_text" 
            value="400" 
            oninput="syncValueFromText('monthly_groceries')"
            onblur="validateInput('monthly_groceries')"
          >
        </div>
      </div>

      <!-- MONTHLY BILLS -->
      <div class="input-group">
        <label for="monthly_bills">Monthly Bills (utilities, phone, etc.) ($/month):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="monthly_bills" 
            min="0" 
            max="20000" 
            step="50" 
            value="250" 
            oninput="syncValueFromSlider('monthly_bills')"
          >
          <input 
            type="text" 
            id="monthly_bills_text" 
            value="250" 
            oninput="syncValueFromText('monthly_bills')"
            onblur="validateInput('monthly_bills')"
          >
        </div>
      </div>

      <!-- MONTHLY HEALTHCARE -->
      <div class="input-group">
        <label for="monthly_healthcare">Monthly Healthcare Costs ($/month):</label>
        <div class="flex-row">
          <input 
            type="range" 
            id="monthly_healthcare" 
            min="0" 
            max="10000" 
            step="100" 
            value="200" 
            oninput="syncValueFromSlider('monthly_healthcare')"
          >
          <input 
            type="text" 
            id="monthly_healthcare_text" 
            value="200" 
            oninput="syncValueFromText('monthly_healthcare')"
            onblur="validateInput('monthly_healthcare')"
          >
        </div>
      </div>

      <button onclick="runSimulation()">Run Simulation</button>
    </div>

    <h2>Results</h2>
    <div id="results">
      <p id="renter_investment"></p>
      <p id="homeowner_investment"></p>
      <p id="final_house_value"></p>
      <p id="homeowner_net_worth"></p>
      <p id="renter_net_worth"></p>
      <p id="lifetime_income"></p>
      <p id="comparison"></p>
      <p id="difference_msg"></p>
    </div>
  </main>

  <footer>
    <p>
      Licensed under GPL 3.0 • Developed by <strong>Eli Gaultney</strong> • 
      <a href="https://github.com/elisspace/own_vs_buy/">GitHub Repo</a>
    </p>
  </footer>

  <script>
    // Sync from range input -> text input
    function syncValueFromSlider(id) {
      const rangeElement = document.getElementById(id);
      const textElement = document.getElementById(id + '_text');
      textElement.value = rangeElement.value;
    }

    // Sync from text input -> range input
    function syncValueFromText(id) {
      const rangeElement = document.getElementById(id);
      const textElement = document.getElementById(id + '_text');
      rangeElement.value = textElement.value;
    }

    // Basic validation to ensure numeric input and within min/max
    function validateInput(id) {
      const rangeElement = document.getElementById(id);
      const textElement = document.getElementById(id + '_text');

      let value = parseFloat(textElement.value);
      if (isNaN(value)) {
        alert("Invalid input. Please enter a valid numeric value.");
        textElement.value = rangeElement.value;
        return;
      }

      let min = parseFloat(rangeElement.min);
      let max = parseFloat(rangeElement.max);

      if (value < min) {
        alert("Value is below the minimum of " + min + ".");
        value = min;
      } else if (value > max) {
        alert("Value is above the maximum of " + max + ".");
        value = max;
      }

      textElement.value = value;
      rangeElement.value = value;
    }

    function runSimulation() {
      // Gather parameters
      var params = {
        // Existing fields:
        annual_income: parseFloat(document.getElementById('annual_income').value),
        home_price: parseFloat(document.getElementById('home_price').value),
        down_payment: parseFloat(document.getElementById('down_payment').value),
        mortgage_rate: parseFloat(document.getElementById('mortgage_rate').value) / 100,
        mortgage_term: parseFloat(document.getElementById('mortgage_term').value),
        property_tax_rate: parseFloat(document.getElementById('property_tax_rate').value) / 100,
        homeowner_insurance: parseFloat(document.getElementById('homeowner_insurance').value),
        maintenance_rate: parseFloat(document.getElementById('maintenance_rate').value) / 100,
        rent: parseFloat(document.getElementById('rent').value),
        rent_escalation_rate: parseFloat(document.getElementById('rent_escalation_rate').value) / 100,
        home_appreciation: parseFloat(document.getElementById('home_appreciation').value) / 100,
        investment_return: parseFloat(document.getElementById('investment_return').value) / 100,
        marginal_tax_rate: parseFloat(document.getElementById('marginal_tax_rate').value) / 100,
        inflation_rate: parseFloat(document.getElementById('inflation_rate').value) / 100,
        start_age: parseFloat(document.getElementById('start_age').value),
        end_age: parseFloat(document.getElementById('end_age').value),
        annual_salary_growth: 0.02,  // fixed for now
        renters_insurance_annual: 240,

        // New monthly expenses:
        monthly_travel: parseFloat(document.getElementById('monthly_travel').value),
        monthly_groceries: parseFloat(document.getElementById('monthly_groceries').value),
        monthly_bills: parseFloat(document.getElementById('monthly_bills').value),
        monthly_healthcare: parseFloat(document.getElementById('monthly_healthcare').value)
      };

      // Post the parameters to the backend
      fetch('/calculate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(params)
      })
      .then(response => response.json())
      .then(data => {
        // Display main results
        document.getElementById('renter_investment').innerText =
          "Renter's Final Investment Balance: $" + data.renter_final_investment.toFixed(2);

        document.getElementById('homeowner_investment').innerText =
          "Homeowner's Final Investment Balance: $" + data.homeowner_final_investment.toFixed(2);

        document.getElementById('final_house_value').innerText =
          "Final House Value: $" + data.final_house_value.toFixed(2);

        // Highlight negative net worth in red:
        const homeownerNetWorthEl = document.getElementById('homeowner_net_worth');
        const renterNetWorthEl = document.getElementById('renter_net_worth');

        homeownerNetWorthEl.innerText = "Homeowner Net Worth: $" + data.homeowner_net_worth.toFixed(2);
        renterNetWorthEl.innerText = "Renter Net Worth: $" + data.renter_net_worth.toFixed(2);

        if (data.homeowner_net_worth < 0) {
          homeownerNetWorthEl.style.color = "red";
        } else {
          homeownerNetWorthEl.style.color = "inherit";
        }

        if (data.renter_net_worth < 0) {
          renterNetWorthEl.style.color = "red";
        } else {
          renterNetWorthEl.style.color = "inherit";
        }

        document.getElementById('lifetime_income').innerText =
          "Lifetime Income: $" + data.lifetime_income.toFixed(2);

        // Simple comparison message
        let comparison = "";
        if (data.homeowner_net_worth > data.renter_net_worth) {
          comparison = "Home ownership is better over the set duration.";
        } else if (data.homeowner_net_worth < data.renter_net_worth) {
          comparison = "Renting is better over the set duration.";
        } else {
          comparison = "They are effectively the same over the set duration.";
        }
        document.getElementById('comparison').innerText = comparison;

        // Show difference in net amounts
        let difference = data.homeowner_net_worth - data.renter_net_worth;
        const differenceMsgEl = document.getElementById('difference_msg');
        if (difference > 0) {
          differenceMsgEl.innerText =
            "By buying you'll come out $" + difference.toFixed(2) + " ahead.";
        } else if (difference < 0) {
          differenceMsgEl.innerText =
            "By renting you'll come out $" + Math.abs(difference).toFixed(2) + " ahead.";
        } else {
          differenceMsgEl.innerText = "Both scenarios end up exactly the same!";
        }
      })
      .catch(error => console.error("Error in fetch /calculate:", error));
    }
  </script>
</body>
</html>

